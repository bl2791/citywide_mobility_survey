# Results

```{r}
library(tidyverse)
library(ggthemes)
library(parcoords)
load("data/travel_data.rda")  # df_travel
load("data/mobility_general.rda")  # df_general
weight <- read.csv("data/weight_fill.csv")
```

```{r, echo=FALSE}
# Define a function to set the theme of plots
theme_user <- function(total_size, title_size, subtitle_size, angle) {
  theme_plot <- theme_bw(total_size) +
  theme(axis.text.x = element_text(size = rel(0.8), angle = angle, vjust = 0.5),
        axis.text.y = element_text(size = rel(0.8)), 
        axis.ticks.y = element_blank(),
        axis.title.x = element_text(size = rel(0.7)),
        axis.title.y = element_text(size = rel(0.7)),
        panel.grid.major.x = element_line(size = 0.8),
        panel.grid.major.y = element_line(size = 0.8),
        panel.grid.minor.x = element_blank(),
        plot.title = element_text(size = title_size), 
        plot.subtitle = element_text(color = "gray30", size = subtitle_size),
        plot.caption = element_text(size = rel(0.5)),
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.6, "cm"),
        panel.spacing = unit(.5, 'pt'))
  return <- theme_plot
}
```


## 5.1 Is there any differences between the gender composition in each transportation mode?

Calculate the proportion of the respondents with different gender. There are totally 41.12% males and 58.77% females among all the respondents.

```{r}
traveler_gender <- df_general[c(1:2, 31)]

traveler_gender['gender'] <- factor(traveler_gender$qgender)

traveler_gender %>%
  group_by(gender) %>%
  summarise(num = sum(allwt)) %>%
  ungroup() %>%
  mutate(prop = num / sum(num)) %>% 
  ggplot(aes(reorder(gender, -prop), prop)) +
  geom_col() +
  labs(x = 'Gender', y = 'Count', title = "Propotion of Male and Female Respondents", 
       caption = "Source: https://data.cityofnewyork.us/Transportation/Citywide-Mobility-Survey-Main-Survey/dd6w-hnq9") +
  theme_wsj() +
  scale_x_discrete(labels=c("1" = "Male", "2" = "Female", "3" = "Don't know", "4" = "Refused")) +
  theme_user(16, 16, 12, 0)
```

After removing the records which are "Don't know" or "Refused" in Gender, we plot a stacked bar chart and use the proportion of each gender we calculated above as the basis for comparison. We can easily notice that the gender composition among different transportation modes are different, expecially between bicycle and the other modes. Almost 70% residents that prefer riding a bicyle to get around the city are males, greatly beyond the number of females. On the contrary, less males than females would like to choose bus, for-hire vehicle and walk, which is not due to the unbalanced sampling proportion of different gender.

In order to interpret the huge difference between the number of males and females prefering bicycle, we propose several possible reasons. It may be because females do not think riding bicycle is safe enough in New York City due to the high crime rate, or males want to make use of their spare time to take exercise, for which riding bicycle is a good idea. We can further verify our assumptions by exploring the question in the questionaire, "Which of the following words most apply to Bicycling?".   

```{r, echo=FALSE}
# Transportation mode ~ Gender
traveler_gender1 <- traveler_gender[c(1, 4)] %>%
  filter(gender %in% c(1, 2))
travel_mode <- df_travel[c(1, 5:12)]

df1 <- merge(travel_mode, traveler_gender1, by = "UniqueID", all.y = TRUE) %>%
  gather(key = 'Mode', value = "Number", -c(1, 10)) %>%
  merge(weight, by = "UniqueID", all = TRUE) %>%
  mutate(Count = weight_fill * Number) %>%
  group_by(Mode, gender) %>%
  summarise(Sum = sum(Count)) %>%
  ungroup() %>%
  group_by(Mode) %>%
  mutate(Prop = Sum/sum(Sum), Order = last(Prop)) %>%
  ungroup()
df1
ggplot(df1, aes(reorder(Mode, -Order), Sum, fill = gender)) +
  geom_bar(stat="identity", position = "fill") + 
  labs(x = 'Transportation Mode', y = 'Proportion', title = "Gender Composition in Transportation Mode",
       caption = "Source: https://data.cityofnewyork.us/Transportation/Citywide-Mobility-Survey-Main-Survey/dd6w-hnq9") +
  theme_wsj() +
  scale_fill_brewer(palette = "Set2", name = "Gender", labels = c("Male", "Female")) +
  theme_user(16, 16, 12, 45)
```

```{r}
library(ggmosaic)

survey <- read.csv("data/raw_survey_data.csv")

survey <- survey %>%
  subset(select = c("UniqueID", "qgender", "gFOCUSAA1_qFOCUSAA6_mA1", "gFOCUSAA1_qFOCUSAA6_mA2", 
                    "gFOCUSAA1_qFOCUSAA6_mA3", "gFOCUSAA1_qFOCUSAA6_mA4",
                    "gFOCUSAA1_qFOCUSAA6_mA5", "gFOCUSAA1_qFOCUSAA6_mA6",
                    "gFOCUSAA1_qFOCUSAA6_mA7", "gFOCUSAA1_qFOCUSAA6_mA8", "allwt"))

colnames(survey) <- c("UniqueID", "Gender", "Convenient", "Reliable", 
                      "Fast", "Inexpensive", "Safe", "Comfortable","Don't know", "Refused", "allwt")

survey$Safe[survey$Safe == "0"] <- "No"
survey$Safe[survey$Safe == "1"] <- "Yes"
survey$Gender[survey$Gender == '1'] <- "Male"
survey$Gender[survey$Gender == '2'] <- "Female"
survey$Gender[survey$Gender == '3'] <- "Don't know"
survey$Gender[survey$Gender == '4'] <- "Refused"

survey['Gender'] <- factor(survey$Gender, levels = c("Male", "Female", "Don't know", "Refused"))
survey['Safe'] <- factor(survey$Safe)
survey_1 <- merge(travel_mode, survey, by = "UniqueID", all.x = TRUE) %>%
  filter(Bicycle == 0) %>%  # Only forcus on those did not choose bicycle
  subset(select = c(1, 10, 15, 19)) %>%
  group_by(Safe, Gender) %>%
  summarise(Count = sum(allwt)) %>%
  ungroup()


ggplot(survey_1) +
   geom_mosaic(aes(x = product(Gender, Safe), fill = Gender, weight = Count), offset = 0.028) + 
   labs(x = 'Safe', y = 'Gender', title = "Proportion of Males and Females with Different Answers",
        caption = "Source: https://data.cityofnewyork.us/Transportation/Citywide-Mobility-Survey-Main-Survey/dd6w-hnq9") +
   scale_fill_brewer(palette = "Set2") +
   theme_wsj() +
   theme_user(14, 14, 12, 0) + 
   theme(legend.position = "none")
```



